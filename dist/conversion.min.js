!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Conversion=n()}(this,function(){"use strict";var e={containerToInsert:".js-content-insert",containerToSearchLinks:"body",disableAttribute:"data-ajax-disabled",saveBack:!0,scrollToTop:!0};function i(t,n){return Object.assign({},t,n)}function o(t){return"function"==typeof t}function a(t){console.error("Conversion: "+t)}var s=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},r=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}(),u=function(){function t(){s(this,t),this.events={}}return r(t,[{key:"on",value:function(t,n){o(n)?this.events[t]=n:a("event handler isn't a function")}},{key:"emit",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!this.events[t])return null;this.events[t](n)}}]),t}();return function(){function n(t){s(this,n),this.options=i(e,t),this.eventBus=new u,this.disabled=!1,this.links=[],this.oldLinks=[],this._isBack=!1,this._hostName=location.hostname,this._dom={},this._isDisableAjax=this._isDisableAjax.bind(this),this._handleLink=this._handleLink.bind(this),this._handleLinkClick=this._handleLinkClick.bind(this),this._getContentSuccess=this._getContentSuccess.bind(this),this._getContentSuccess=this._getContentSuccess.bind(this),this._getContentFail=this._getContentFail.bind(this)}return r(n,[{key:"init",value:function(){this._dom=this._initDom(),this._initLinks(),this.eventBus.emit("init.finished")}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.options=i(e,t)}},{key:"on",value:function(t,n){this.eventBus.on(t,n)}},{key:"disable",value:function(){this.disabled=!0}},{key:"enable",value:function(){this.disabled=!1}},{key:"_initDom",value:function(){var t={};return t.body=document.getElementsByTagName("body")[0],t.containerToSearchLinks=document.querySelector(this.options.containerToSearchLinks),t.containerToInsert=document.querySelector(this.options.containerToInsert),t}},{key:"_initLinks",value:function(){if(this.links=this._dom.containerToSearchLinks.getElementsByTagName("a"),this.links.length<=0)return null;Array.prototype.forEach.call(this.links,this._handleLink)}},{key:"_isDisableAjax",value:function(t,n){return 0<=n.indexOf("#")||n.indexOf(this._hostName)<0||t.getAttribute(this.options.disableAttribute)}},{key:"_handleLink",value:function(t){var n=t.href;return 0<this.oldLinks.length&&this.oldLinks[this.oldLinks.length-1]===n?null:this._isDisableAjax(t,n)?null:void t.addEventListener("click",this._handleLinkClick)}},{key:"_handleLinkClick",value:function(t){t.preventDefault();var n=t.currentTarget.href;this._isBack=!1,this._getContent(n)}},{key:"_getContent",value:function(t){var n,e,i,s;this.eventBus.emit("request.start"),n=t,e=this._getContentSuccess,i=this._getContentFail,(s=new XMLHttpRequest).addEventListener("load",function(){200<=s.status&&s.status<400?o(e)?e(s.responseText,n):a("callback for request is not a function"):404==s.status&&(o(i)?i(n):a("fail callback for request is not a function"))}),s.onerror=function(){o(i)?i(n):a("fail callback for request is not a function")},s.open("GET",n,!0),s.send()}},{key:"_getContentSuccess",value:function(t,n){this.eventBus.emit("request.success"),this.options.scrollToTop&&window.scrollTo(0,0);var e=document.createElement("html");e.innerHTML=t;var i=e.querySelector(this.options.containerToInsert);if(!i)return null;this._dom.containerToInsert.innerHTML=i.innerHTML,this._isBack?this.oldLinks.pop():this.oldLinks.push(window.location.href),this.options.saveBack&&window.history.pushState(null,null,n),this._initLinks(),this.eventBus.emit("content.inserted")}},{key:"_getContentFail",value:function(){this.eventBus.emit("request.fail")}}]),n}()});
