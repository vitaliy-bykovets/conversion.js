/**
 * conversion.js v0.0.0
 * Copyright 2018-2018 Vitaliy Bykovets
 * Released under the MIT License
 * https://github.com/vitaliy-bykovets/conversion.js
 **/

!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.conversion=t.conversion||{},t.conversion.js=n())}(this,function(){"use strict";var e={containerToInsert:".js-content-insert",containerToSearchLinks:"body",disableAttribute:"data-ajax-disabled",saveBack:!0,scrollToTop:!0,delayContentInsert:!1};function i(t,n){return Object.assign({},t,n)}function s(t){return"function"==typeof t}function o(t){console.error("conversion.js: "+t)}var r=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},a=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}(),u=function(){function t(){r(this,t),this.events={}}return a(t,[{key:"on",value:function(t,n){s(n)?this.events[t]=n:o("event handler isn't a function")}},{key:"emit",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.events[t]?s(this.events[t])?void this.events[t](n):(o("handler for "+t+" event isn't a function"),null):null}}]),t}();function l(t,n,e){var i=new XMLHttpRequest;i.addEventListener("load",function(){200<=i.status&&i.status<400?s(n)?n(i.responseText,t):o("callback for request is not a function"):404==i.status&&(s(e)?e(t):o("fail callback for request is not a function"))}),i.onerror=function(){s(e)?e(t):o("fail callback for request is not a function")},i.open("GET",t,!0),i.send()}return function(){function n(t){r(this,n),this.options=i(e,t),this.disabled=!1,this.links=[],this.oldLinks=[window.location.href],this._eventBus=new u,this._isBack=!1,this._hostName=window.location.hostname,this._dom={}}return a(n,[{key:"init",value:function(){return this._eventBus.emit("init.started"),this._bindMethods(),this._dom=this._initDom(),this._initLinks(),this.options.saveBack&&this._initWindowPopStateHandler(),this._eventBus.emit("init.finished"),this}},{key:"updateLinks",value:function(){return this._initLinks(),this}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.options=i(e,t),this}},{key:"on",value:function(t,n){return this._eventBus.on(t,n),this}},{key:"emit",value:function(t){return this._eventBus.emit(t),this}},{key:"disable",value:function(){return this.disabled=!0,this}},{key:"enable",value:function(){return this.disabled=!1,this}},{key:"_initDom",value:function(){var t={};return t.containerToSearchLinks=document.querySelector(this.options.containerToSearchLinks),t.containerToInsert=document.querySelector(this.options.containerToInsert),t}},{key:"_initLinks",value:function(){if(this.links=this._dom.containerToSearchLinks.getElementsByTagName("a"),this.links.length<=0)return null;Array.prototype.forEach.call(this.links,this._handleLink)}},{key:"_initWindowPopStateHandler",value:function(){var t=this;window.onpopstate=function(){t._prevOldLink&&(t._isBack=!0,t._getContent(t._prevOldLink))}}},{key:"_isDisableAjax",value:function(t,n){return 0<=n.indexOf("#")||n.indexOf(this._hostName)<0||t.hasAttribute(this.options.disableAttribute)}},{key:"_handleLink",value:function(t){t.addEventListener("click",this._handleLinkClick)}},{key:"_handleLinkClick",value:function(t){var n=t.currentTarget,e=n.href;return this._isDisableAjax(n,e)?null:this._lastOldLink===e?null:this.disabled?null:(t.preventDefault(),this._getContent(e),void this._eventBus.emit("click.executed"))}},{key:"_getContent",value:function(t){var n=this;this.options.delayContentInsert?this._eventBus.on("request.activate",function(){n._eventBus.emit("request.start"),l(t,n._getContentSuccess,n._getContentFail)}):(this._eventBus.emit("request.start"),l(t,this._getContentSuccess,this._getContentFail))}},{key:"_getContentSuccess",value:function(t,n){this._eventBus.emit("request.success"),this.options.scrollToTop&&window.scrollTo(0,0),this._insertContent(t,n)}},{key:"_insertContent",value:function(t,n){this._eventBus.emit("content.insert-started",this._dom.containerToInsert.innerHTML);var e=this._getContentFragment(t),i=e.querySelector(this.options.containerToInsert);if(!i)return null;this._dom.containerToInsert.innerHTML=i.innerHTML,this._setBackAction(n),this._initLinks(),this._eventBus.emit("content.inserted",e)}},{key:"_getContentFail",value:function(){this._eventBus.emit("request.fail")}},{key:"_getContentFragment",value:function(t){var n=document.createElement("html");return n.innerHTML=t,n}},{key:"_setBackAction",value:function(t){this.options.saveBack&&window.history.pushState(null,null,t),this._isBack?this.oldLinks.pop():this.oldLinks.push(t),this._isBack=!1}},{key:"_bindMethods",value:function(){this._isDisableAjax=this._isDisableAjax.bind(this),this._handleLink=this._handleLink.bind(this),this._handleLinkClick=this._handleLinkClick.bind(this),this._getContentSuccess=this._getContentSuccess.bind(this),this._getContentSuccess=this._getContentSuccess.bind(this),this._getContentFail=this._getContentFail.bind(this)}},{key:"_lastOldLink",get:function(){return 0<this.oldLinks.length&&this.oldLinks[this.oldLinks.length-1]}},{key:"_prevOldLink",get:function(){return 0<this.oldLinks.length&&this.oldLinks[this.oldLinks.length-2]}}]),n}()});
