!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.Conversion=t()}(this,function(){"use strict";var e={containerToInsert:".js-content-insert",disableAttribute:"data-ajax-disabled",scrollToTop:!0};function i(n,t){return Object.assign({},n,t)}function s(n){return"function"==typeof n}function a(n){console.error("Conversion: "+n)}var o=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function i(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(n,t,e){return t&&i(n.prototype,t),e&&i(n,e),n}}(),u=function(){function n(){o(this,n),this.events={}}return r(n,[{key:"on",value:function(n,t){s(t)?this.events[n]=t:a("event handler isn't a function")}},{key:"emit",value:function(n){this.events[n]()}}]),n}();return function(){function t(n){o(this,t),this.options=i(e,n),this.eventBus=new u,this.disabled=!1,this.links=[],this.oldLinks=[],this._isBack=!1,this._hostName=location.hostname,this._dom={}}return r(t,[{key:"init",value:function(){this._dom=this._initDom(),this._initLinks()}},{key:"update",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.options=i(e,n)}},{key:"on",value:function(n,t){this.eventBus.on(n,t)}},{key:"disable",value:function(){this.disabled=!0}},{key:"enable",value:function(){this.disabled=!1}},{key:"_initDom",value:function(){var n={};return n.body=document.getElementsByTagName("body")[0],n.containerToInsert=n.body.querySelector(this.options.containerToInsert),n}},{key:"_initLinks",value:function(){if(this.links=this._dom.containerToInsert.getElementsByTagName("a"),this.links.length<=0)return null;Array.prototype.forEach.call(this.links,this._handleLink)}},{key:"_isDisableAjax",value:function(n,t){return 0<=t.indexOf("#")||t.indexOf(this.hostName)<0||n.getAttribute(this.options.disableAttribute)}},{key:"_handleLink",value:function(n){var t=n.href;if(this._isDisableAjax(n,t))return null;n.addEventListener("click",this._handleLinkClick)}},{key:"_handleLinkClick",value:function(n){n.preventDefault();var t=n.currentTarget.href;this._isBack=!1,this._getContent(t)}},{key:"_getContent",value:function(n){var t,e,i,o;t=n,e=this._getContentSuccess,i=this._getContentFail,(o=new XMLHttpRequest).addEventListener("load",function(){200<=o.status&&o.status<400?s(e)?e(o.responseText,t):a("callback for request is not a function"):404==o.status&&(s(i)?i(t):a("fail callback for request is not a function"))}),o.onerror=function(){s(i)?i(t):a("fail callback for request is not a function")},o.open("GET",t,!0),o.send()}},{key:"_getContentSuccess",value:function(n,t){this.options.scrollToTop&&window.scrollTo(0,0);var e=document.createElement("html");e.innerHTML=n;var i=e.querySelector(this.options.containerToInsert);if(!i)return null;this.DOM.containerToInsert.innerHTML=i.innerHTML,this.DOM.body.classList=responseBody.classList,this._isBack?this.oldLinks.pop():this.oldLinks.push(window.location.href),window.history.pushState(null,null,t),this._initLinks()}},{key:"_getContentFail",value:function(){}}]),t}()});
